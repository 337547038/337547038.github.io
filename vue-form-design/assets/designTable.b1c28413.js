var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{_ as i,a as r,b as d}from"./vueFile.02730b28.js";import{b as c,s as b}from"./index.cff14e94.js";import{O as p,W as u,K as m,j as f,m as h,L as g,M as y,t as v,E as k,r as D,P as x,B as C,o as _,v as j,h as I,F as O,a as V,w,x as E,p as F,X as L,y as G,c as q,n as T,s as z,u as P,Q as U}from"./vendor.e07f640d.js";import{s as B,l as M,o as S}from"./index.6c162138.js";import"./index.0a3ecb31.js";const H={name:"list",props:{},components:{headTools:i,vueFile:r},setup(){const e=p(),{ctx:i}=u(),r=m(),D=f({filedList:[],otherFiled:[{label:"勾选",prop:"__selection",type:"selection"},{label:"序号",prop:"__index",type:"index"},{label:"操作",prop:"__control"}],checkboxGroup:[],tableData:{config:{},columns:[]},editor:{},visibleDialog:!1,loading:!1,queryId:e.query.id,selectCheck:"",editIndex:"",dataList:[{}]}),x=["txt","title","table","component","upload"],C=e=>{e.list.forEach((e=>{"grid"===e.type||"tabs"===e.type?e.columns.forEach((e=>{C(e)})):"card"===e.type?C(e):-1===x.indexOf(e.type)&&D.filedList.push({prop:e.name,label:e.item.label,help:e.config.help||""})}))},_=e=>{D.visibleDialog=!0;const a=S(e,!0);g((()=>{D.editor=d(a)}))},j=()=>{if(!D.queryId)return M("tableData",D.tableData),void k.info("数据已暂存在localStorage");D.loading=!0;const e={tableData:S(D.tableData),id:D.queryId};b(e).then((e=>{200===e.data.code?k({message:"保存成功！",type:"success"}):k.error(e.data.message),D.loading=!1})).catch((e=>{k.error("保存异常"),D.loading=!1}))};if(D.queryId)c(D.queryId).then((e=>{200===e.data.code&&(C(B(e.data.data[0].formData)),D.tableData=B(e.data.data[0].tableData),D.tableData.columns.forEach((e=>{D.checkboxGroup.push(e.label)})))}));else{const e=M();e&&(e.tableData&&(D.tableData=e.tableData),e.formData&&(console.log(e.formData),C(e.formData)))}return h((()=>{g((()=>{(()=>{const e=i.$el.querySelector(".el-table__header-wrapper tr");L.create(e,{animation:180,delay:0,onEnd:e=>{const a=D.tableData.columns[e.oldIndex];D.tableData.columns.splice(e.oldIndex,1),D.tableData.columns.splice(e.newIndex,0,a)}})})()}))})),y((()=>{0!==Object.keys(D.editor).length&&(D.editor.destroy(),D.editor.container.remove())})),I=((e,a)=>{for(var l in a||(a={}))o.call(a,l)&&n(e,l,a[l]);if(t)for(var l of t(a))s.call(a,l)&&n(e,l,a[l]);return e})({headToolClick:e=>{switch(e){case"del":D.tableData.columns=[],D.checkboxGroup=[];break;case"json":_(D.tableData);break;case"vue":r.value.openTable(D.tableData);break;case"import":_({});break;case"save":j()}},checkChange:e=>{-1===D.checkboxGroup.indexOf(e.label)?D.tableData.columns.forEach(((a,l)=>{a.label===e.label&&a.prop===e.prop&&D.tableData.columns.splice(l,1)})):D.tableData.columns.push(e)}},v(D)),a(I,l({dialogConfirm:()=>{try{""!==D.editIndex?(D.tableData.columns[D.editIndex]=B(D.editor.getValue()),D.editIndex=""):D.tableData=B(D.editor.getValue()),D.visibleDialog=!1}catch(e){k.error(e.message)}},drawerBeforeClose:e=>{D.editIndex="",e()},vueFileEl:r,editOtherField:()=>{_(D.tableData)},selectChange:e=>{let a={};D.tableData.columns.forEach(((l,t)=>{l.prop===e&&(a=l,D.editIndex=t)})),_(a)}}));var I}},J={class:"container design-table"},K={class:"components-list"},Q=I("div",{class:"title"},"可选字段",-1),W={class:"content"},X=I("div",{class:"title"},"其他字段",-1),$={class:"content"},A={class:"title"},N=z("编辑自定义字段"),R={class:"main-body"},Y={class:"main-form main-table"},Z=I("p",{style:{padding:"10px 0"}},"点击表头可拖动改变顺序",-1),ee=["innerHTML"],ae=I("i",{class:"icon-help"},null,-1),le={key:1},te={key:2},oe={class:"sidebar-tools"},se=z(" 请使用生成脚本预览功能，编辑config属性 "),ne={key:0,id:"editJson"},ie={class:"dialog-footer"},re=z(" 确定 ");H.render=function(e,a,l,t,o,s){const n=D("el-checkbox"),i=D("el-checkbox-group"),r=D("el-button"),d=D("headTools"),c=D("el-tooltip"),b=D("el-table-column"),p=D("el-table"),u=D("el-option"),m=D("el-select"),f=D("el-form-item"),h=D("el-tab-pane"),g=D("el-tabs"),y=D("el-form"),v=D("el-drawer"),k=D("vue-File"),L=x("loading");return C((_(),j("div",J,[I("div",K,[e.filedList&&e.filedList.length>0?(_(),j(O,{key:0},[Q,I("div",W,[V(i,{modelValue:e.checkboxGroup,"onUpdate:modelValue":a[0]||(a[0]=a=>e.checkboxGroup=a),size:"small"},{default:w((()=>[(_(!0),j(O,null,G(e.filedList,(e=>(_(),q(n,{label:e.label,border:!0,key:e.prop,onChange:a=>t.checkChange(e)},null,8,["label","onChange"])))),128))])),_:1},8,["modelValue"])])],64)):E("",!0),X,I("div",$,[V(i,{modelValue:e.checkboxGroup,"onUpdate:modelValue":a[1]||(a[1]=a=>e.checkboxGroup=a),size:"small"},{default:w((()=>[(_(!0),j(O,null,G(e.otherFiled,(e=>(_(),q(n,{label:e.label,border:!0,key:e.prop,onChange:a=>t.checkChange(e)},null,8,["label","onChange"])))),128))])),_:1},8,["modelValue"])]),I("div",A,[V(r,{size:"small",onClick:t.editOtherField},{default:w((()=>[N])),_:1},8,["onClick"])])]),I("div",R,[V(d,{onClick:t.headToolClick,type:"2"},null,8,["onClick"]),I("div",Y,[Z,V(p,F({data:e.dataList},e.tableData.config,{ref:"tableEl"}),{default:w((()=>[(_(!0),j(O,null,G(e.tableData.columns,(e=>(_(),q(b,U(F({key:e.prop||e.label},e)),T({_:2},[e.help?{name:"header",fn:w((a=>[z(P(a.column.label)+" ",1),V(c,{placement:"top"},{content:w((()=>[I("span",{innerHTML:e.help},null,8,ee)])),default:w((()=>[ae])),_:2},1024)]))}:void 0,"index"!==e.type?{name:"default",fn:w((()=>["selection"===e.type?(_(),q(n,{key:0})):"__control"===e.prop?(_(),j("span",le,"删除")):(_(),j("span",te,"测试数据"))]))}:void 0]),1040)))),128))])),_:1},16,["data"])])]),I("div",oe,[V(y,{size:"small"},{default:w((()=>[V(g,{modelValue:"first"},{default:w((()=>[V(h,{label:"字段属性",name:"first"},{default:w((()=>[V(f,{label:"选择表头字段"},{default:w((()=>[V(m,{modelValue:e.selectCheck,"onUpdate:modelValue":a[2]||(a[2]=a=>e.selectCheck=a),onChange:t.selectChange},{default:w((()=>[(_(!0),j(O,null,G(e.tableData.columns,(e=>(_(),q(u,{key:e.prop,value:e.prop,label:e.label},null,8,["value","label"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1})])),_:1}),V(h,{label:"表格属性",name:"second"},{default:w((()=>[se])),_:1})])),_:1})])),_:1})]),V(v,{modelValue:e.visibleDialog,"onUpdate:modelValue":a[3]||(a[3]=a=>e.visibleDialog=a),size:"60%",direction:"rtl","custom-class":"json-dialog","append-to-body":!0,"before-close":t.drawerBeforeClose},{default:w((()=>[e.visibleDialog?(_(),j("div",ne)):E("",!0),I("div",ie,[V(r,{type:"primary",size:"small",onClick:t.dialogConfirm},{default:w((()=>[re])),_:1},8,["onClick"])])])),_:1},8,["modelValue","before-close"]),V(k,{ref:"vueFileEl"},null,512)],512)),[[L,e.loading]])};export{H as default};
